<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Version Control with Git</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">Version Control with Git</h1></a>
          <h2 class="subtitle">Exploring History and Undoing Mistakes</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Identify commits by their Git commit numbers.</li>
<li>Restore old versions of files.</li>
<li>Identify commits by how many commits have happened since.</li>
<li>Compare different versions of tracked files.</li>
</ul>
</div>
</section>
<p>Recall that <code>git log</code> shows us the history of our project by listing the commits we have made, their dates, and their commit messages:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> log</code></pre>
<pre class="output"><code>commit 005937fbe2a98fb83f0ade869025dc2636b4dad5
Author: Vlad Dracula &lt;vlad@tran.sylvan.ia&gt;
Date:   Thu Aug 22 10:14:07 2013 -0400

    Discuss concerns about Mars&#39; climate for Mummy

commit 34961b159c27df3b475cfe4415d94a6d1fcd064d
Author: Vlad Dracula &lt;vlad@tran.sylvan.ia&gt;
Date:   Thu Aug 22 10:07:21 2013 -0400

    Add concerns about effects of Mars&#39; moons on Wolfman

commit f22b25e3233b4645dabd0d81e651fe074bd8e73b
Author: Vlad Dracula &lt;vlad@tran.sylvan.ia&gt;
Date:   Thu Aug 22 09:51:46 2013 -0400

    Start notes on Mars as a base</code></pre>
<p>Because git keeps track of not only the current state of our files but also their entire history, we can restore any file (or even the entire project) to any place in its history. This is very useful if we make a mistake and want to undo it!</p>
<p>For example, let’s suppose we accidentally overwrite our file:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">nano</span> mars.txt
$ <span class="kw">cat</span> mars.txt</code></pre>
<pre class="output"><code>We will need to manufacture our own oxygen</code></pre>
<p><code>git status</code> now tells us that the file has been changed, but those changes haven’t been staged to be committed:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> status</code></pre>
<pre class="output"><code># On branch master
# Changes not staged for commit:
#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)
#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)
#
#   modified:   mars.txt
#
no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</code></pre>
<p>Let’s restore the version of <code>mars.txt</code> from the most recent commit. Each commit is uniquely identified by a long string of letters and digits; we can find a commit’s identifier from its entry in <code>git log</code>. Looking above, we see that our most recent commit has the identifier <code>005937fbe2a98fb83f0ade869025dc2636b4dad5</code>. We can ask for the version of <code>mars.txt</code> from that commit using <code>git checkout</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> checkout 005937fbe2a98fb83f0ade869025dc2636b4dad5 mars.txt
$ <span class="kw">cat</span> mars.txt</code></pre>
<pre class="output"><code>Cold and dry, but everything is my favorite color
The two moons may be a problem for Wolfman
But the Mummy will appreciate the lack of humidity</code></pre>
<p>Ah, crisis averted – Git is a lifesaver for anyone who has every accidentally deleted a file.</p>
<p>Using <code>git checkout</code>, we can look at any commit in the history of the project. However, typing out random 40-character strings is annoying, so Git lets us use just the first few characters:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> checkout 34961b1 mars.txt
$ <span class="kw">cat</span> mars.txt</code></pre>
<pre class="output"><code>Cold and dry, but everything is my favorite color
The two moons may be a problem for Wolfman</code></pre>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Don’t lose your HEAD</h2>
</div>
<div class="panel-body">
<p>Above we used</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> checkout 34961b1 mars.txt</code></pre>
<p>to revert mars.txt to its state after the commit 34961b1. If you forget <code>mars.txt</code> in that command, git will tell you that “You are in ‘detached HEAD’ state.” In this state, you shouldn’t make any changes. You can fix this by reattaching your head using <code>git checkout master</code></p>
</div>
</aside>
<p>Sometimes it’s easier to refer to commits not by their commit ID but by how many commits ago they were. The most recent commit is always called <code>HEAD</code>, the commit before that is called <code>HEAD~1</code> (pronounced “<code>HEAD</code> minus one”), the commit before <em>that</em> is <code>HEAD~2</code>, etc. This makes it easy to recover from mistakes by going back to the most recent commit:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">nano</span> mars.txt
$ <span class="kw">cat</span> mars.txt</code></pre>
<pre class="output"><code>We must take care not to disturb the native lifeforms!</code></pre>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> checkout HEAD mars.txt
$ <span class="kw">cat</span> mars.txt</code></pre>
<pre class="output"><code>Cold and dry, but everything is my favorite color
The two moons may be a problem for Wolfman
But the Mummy will appreciate the lack of humidity</code></pre>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Choose the right commit</h2>
</div>
<div class="panel-body">
<p>If we’re trying to undo a mistake that was made several commits ago, a common mistake is to <code>git checkout</code> the commit in which that change was made. Remember to use the commit number that identifies the state of the repository <em>before</em> the change we’re trying to undo.</p>
</div>
</aside>
<p>Finally, if we want to see what changed since a particular commit, we can use <code>git diff</code> again. For example, to see what has changed since the last commit:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> diff HEAD~1 mars.txt</code></pre>
<pre class="output"><code>diff --git a/mars.txt b/mars.txt
index 315bf3a..b36abfd 100644
--- a/mars.txt
+++ b/mars.txt
@@ -1,2 +1,3 @@
 Cold and dry, but everything is my favorite color
 The two moons may be a problem for Wolfman
+But the Mummy will appreciate the lack of humidity</code></pre>
<p>We can also refer to a commit by its commit identifier:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">git</span> diff f22b25e mars.txt</code></pre>
<pre class="output"><code>diff --git a/mars.txt b/mars.txt
index df0654a..b36abfd 100644
--- a/mars.txt
+++ b/mars.txt
@@ -1 +1,3 @@
 Cold and dry, but everything is my favorite color
+The two moons may be a problem for Wolfman
+But the Mummy will appreciate the lack of humidity</code></pre>
<div class="figure">
<img src="fig/git-checkout.svg" alt="Git Checkout" /><p class="caption">Git Checkout</p>
</div>
<p>So, to put it all together:</p>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>How Git works, in cartoon form</h2>
</div>
<div class="panel-body">
<div class="figure">
<img src="fig/git_staging.svg" alt="http://figshare.com/articles/How_Git_works_a_cartoon/1328266" /><p class="caption">http://figshare.com/articles/How_Git_works_a_cartoon/1328266</p>
</div>
</div>
</aside>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pushpin"></span>Simplifying the Common Case</h2>
</div>
<div class="panel-body">
<p>If you read the output of <code>git status</code> carefully, you’ll see that it includes this hint:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">(use</span> <span class="st">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="kw">)</span></code></pre>
<p>As it says, <code>git checkout</code> without a version identifier restores files to the state saved in <code>HEAD</code>. The double dash <code>--</code> is needed to separate the names of the files being recovered from the command itself: without it, Git would try to use the name of the file as the commit identifier.</p>
</div>
</aside>
<p>The fact that files can be reverted one by one tends to change the way people organize their work. If everything is in one large document, it’s hard (but not impossible) to undo changes to the introduction without also undoing changes made later to the conclusion. If the introduction and conclusion are stored in separate files, on the other hand, moving backward and forward in time becomes much easier.</p>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Recovering Older Versions of a File</h2>
</div>
<div class="panel-body">
<p>Jennifer has made changes to the Python script that she has been working on for weeks, and the modifications she made this morning “broke” the script and it no longer runs. She has spent ~ 1hr trying to fix it, with no luck…</p>
<p>Luckily, she has been keeping track of her project’s versions using Git! Which commands below will let her recover the last committed version of her Python script called <code>data_cruncher.py</code>?</p>
<ol style="list-style-type: decimal">
<li><pre><code>$ git checkout HEAD</code></pre></li>
<li><pre><code>$ git checkout HEAD data_cruncher.py</code></pre></li>
<li><pre><code>$ git checkout HEAD~1 data_cruncher.py</code></pre></li>
<li><pre><code>$ git checkout &lt;unique ID of last commit&gt; data_cruncher.py</code></pre></li>
<li>Both 2 &amp; 4</li>
</ol>
</div>
</section>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2><span class="glyphicon glyphicon-pencil"></span>Understanding Workflow and History</h2>
</div>
<div class="panel-body">
<p>What is the output of cat venus.txt at the end of this set of commands?</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">cd</span> planets
$ <span class="kw">nano</span> venus.txt <span class="co">#input the following text: Venus is beautiful and full of love</span>
$ <span class="kw">git</span> add venus.txt
$ <span class="kw">nano</span> venus.txt <span class="co">#add the following text: Venus is too hot to be suitable as a base</span>
$ <span class="kw">git</span> commit -m <span class="st">&quot;comments on Venus as an unsuitable base&quot;</span>
$ <span class="kw">git</span> checkout HEAD venus.txt
$ <span class="kw">cat</span> venus.txt <span class="co">#this will print the contents of venus.txt to the screen</span></code></pre>
<ol style="list-style-type: decimal">
<li><pre class="output"><code>Venus is too hot to be suitable as a base</code></pre></li>
<li><pre class="output"><code>Venus is beautiful and full of love</code></pre></li>
<li><pre class="output"><code>Venus is beautiful and full of love
Venus is too hot to be suitable as a base</code></pre></li>
<li><pre class="output"><code>Error because you have changed venus.txt without committing the changes</code></pre></li>
</ol>
</div>
</section>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/git-novice">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
